{{- /*
  Note that changes to the rendered version of this
  file will trigger a restart of the BinderHub pod
  through a annotation containing a hash of this
  file rendered.
*/ -}}
kind: Secret
apiVersion: v1
metadata:
  name: binder-secret
type: Opaque
stringData:
  {{- /* Make it easy to mount certain parts without traversing YAML */}}
  binder.hub-token: {{ .Values.jupyterhub.hub.services.binder.apiToken | quote }}

  {{- /*
    Stash away relevant Helm template values for
    the BinderHub Python application to read from
    in binderhub_config.py.
  */}}
  values.yaml: |
    {{- pick .Values "config" "cors" "dind" "extraConfig" | toYaml | nindent 4 }}

  {{- /* Glob files to allow them to be mounted by the binderhub pod */}}
  {{- /* key=filename: value=content */}}
  {{- (.Files.Glob "files/*").AsConfig | nindent 2 }}
---
{{- if .Values.config.BinderHub.use_registry }}
kind: Secret
apiVersion: v1
metadata:
  name: binder-push-secret
type: Opaque
data:
  config.json: {{ include "registryDockerConfig" . | b64enc | quote }}
{{- end }}
